<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Shooting Game</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; background:#222; }
  #ui {
    position:absolute; top:10px; left:10px; color:white; z-index:10;
  }
  #start-screen, #game-over-screen {
    position:absolute; inset:0; background:rgba(0,0,0,0.85); color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; z-index:10;
  }
  button { padding:10px 20px; font-size:16px; border:none; border-radius:6px; cursor:pointer; background:#4caf50; color:white; }
</style>
</head>
<body>

<div id="ui">
  <div id="scoreboard">Score: 0</div>
  <div id="levelboard">Level: 1</div>
  <div id="livesboard">Lives: 3</div>
</div>

<div id="start-screen">
  <h2>Welcome to 3D Shooting Game!</h2>
  <p>Move with <b>A</b> / <b>D</b>, shoot with <b>Left Click</b></p>
  <button id="start-btn">Start Game</button>
</div>

<div id="game-over-screen" style="display:none;">
  <h2>Game Over!</h2>
  <p id="final-score"></p>
  <button id="restart-btn">Restart</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
let scene, camera, renderer;
let player, bullets=[], enemies=[];
let score = 0, level = 1, lives = 3;
let running = false, keys={};
let ENEMY_SPEED = 0.05, PLAYER_SPEED = 0.1;
let lastEnemySpawn = 0, ENEMY_INTERVAL = 2000;

// UI
const scoreboard = document.getElementById('scoreboard');
const levelboard = document.getElementById('levelboard');
const livesboard = document.getElementById('livesboard');
const startScreen = document.getElementById('start-screen');
const startBtn = document.getElementById('start-btn');
const gameOverScreen = document.getElementById('game-over-screen');
const finalScore = document.getElementById('final-score');
const restartBtn = document.getElementById('restart-btn');

// Initialize 3D scene
function init(){
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.z = 5;
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Player cube
  const geometry = new THREE.BoxGeometry(0.5,0.5,0.5);
  const material = new THREE.MeshBasicMaterial({color:0x0000ff});
  player = new THREE.Mesh(geometry, material);
  player.position.y = -2;
  scene.add(player);

  window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // Mouse click shooting
  window.addEventListener('mousedown', (e)=>{
    if(running && e.button === 0){ // left click
      shootBullet();
    }
  });
}

// Spawn enemy
function spawnEnemy(){
  if(!running) return;
  const geometry = new THREE.BoxGeometry(0.5,0.5,0.5);
  const material = new THREE.MeshBasicMaterial({color:0xff0000});
  const enemy = new THREE.Mesh(geometry, material);
  enemy.position.x = (Math.random()-0.5)*6;
  enemy.position.y = 3;
  scene.add(enemy);
  enemies.push(enemy);
}

// Shoot bullet
function shootBullet(){
  const geometry = new THREE.BoxGeometry(0.1,0.3,0.1);
  const material = new THREE.MeshBasicMaterial({color:0xffff00});
  const bullet = new THREE.Mesh(geometry, material);
  bullet.position.set(player.position.x, player.position.y+0.3, 0);
  scene.add(bullet);
  bullets.push(bullet);
}

// Handle continuous movement
document.addEventListener('keydown', e => { keys[e.key.toLowerCase()] = true; });
document.addEventListener('keyup', e => { keys[e.key.toLowerCase()] = false; });

function updatePlayer(){
  if(keys['a']) player.position.x -= PLAYER_SPEED;
  if(keys['d']) player.position.x += PLAYER_SPEED;
  player.position.x = THREE.MathUtils.clamp(player.position.x,-3,3);
}

// Game loop
let lastTime = 0;
function animate(time){
  if(!running){ renderer.render(scene, camera); return; }
  requestAnimationFrame(animate);
  const delta = time - lastTime;
  lastTime = time;

  updatePlayer();

  // Spawn enemies
  if(time - lastEnemySpawn > ENEMY_INTERVAL){ spawnEnemy(); lastEnemySpawn = time; }

  // Move bullets
  bullets.forEach((b,i)=>{
    b.position.y += 0.1;
    if(b.position.y>3){ scene.remove(b); bullets.splice(i,1); }
  });

  // Move enemies
  enemies.forEach((e,i)=>{
    e.position.y -= ENEMY_SPEED;

    // Collision
    bullets.forEach((b,j)=>{
      if(Math.abs(b.position.x-e.position.x)<0.3 && Math.abs(b.position.y-e.position.y)<0.3){
        scene.remove(b); bullets.splice(j,1);
        scene.remove(e); enemies.splice(i,1);
        score += 10;
        scoreboard.textContent = 'Score: '+score;
      }
    });

    if(e.position.y < -3){
      scene.remove(e); enemies.splice(i,1);
      lives--;
      livesboard.textContent = 'Lives: '+lives;
      if(lives<=0) endGame();
    }
  });

  // Level up
  let newLevel = Math.floor(score/100)+1;
  if(newLevel>level){
    level = newLevel;
    ENEMY_SPEED += 0.01;
    ENEMY_INTERVAL = Math.max(500, ENEMY_INTERVAL-100);
    levelboard.textContent = 'Level: '+level;
  }

  renderer.render(scene, camera);
}

// Start / Restart
function startGame(){
  if(!scene) init();
  score=0; level=1; lives=3;
  bullets.forEach(b=>scene.remove(b)); bullets=[];
  enemies.forEach(e=>scene.remove(e)); enemies=[];
  running=true;
  scoreboard.textContent='Score: 0';
  levelboard.textContent='Level: 1';
  livesboard.textContent='Lives: 3';
  startScreen.style.display='none';
  gameOverScreen.style.display='none';
  player.position.set(0,-2,0);
  lastTime=0;
  animate(0);
}

function endGame(){
  running=false;
  finalScore.textContent='Your score: '+score;
  gameOverScreen.style.display='flex';
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);

</script>
</body>
</html>

