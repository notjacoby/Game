<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Auto-Aim Shooter</title>
<style>
body { margin:0; overflow:hidden; background:#222; font-family:sans-serif; }
#ui { position:absolute; top:10px; left:10px; color:white; z-index:10; }
#start-screen, #game-over-screen {
  position:absolute; inset:0; background:rgba(0,0,0,0.85); color:white;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; z-index:10;
  text-align:center;
}
button { padding:10px 20px; font-size:16px; border:none; border-radius:6px; cursor:pointer; background:#4caf50; color:white; }
select { padding:5px; font-size:16px; }
#mobile-controls { position:absolute; bottom:20px; width:100%; display:flex; justify-content:center; gap:20px; z-index:10; }
.control-btn { width:60px; height:60px; background:rgba(255,255,255,0.3); border-radius:50%; font-size:24px; text-align:center; line-height:60px; user-select:none; }
.control-btn:active { background:rgba(255,255,255,0.6); }
</style>
</head>
<body>

<div id="ui">
  <div id="scoreboard">Score: 0</div>
  <div id="levelboard">Level: 1</div>
  <div id="livesboard">Lives: 3</div>
</div>

<div id="start-screen">
  <h2>3D Shooter</h2>
  <p id="instructions">Move: A/D | Shoot: Left Click</p>
  <label>Select Gun:
    <select id="gunSelect">
      <option value="ak">AK-47</option>
      <option value="deagle">Deagle</option>
    </select>
  </label>
  <button id="start-btn">Start Game</button>
</div>

<div id="game-over-screen" style="display:none;">
  <h2>Game Over!</h2>
  <p id="final-score"></p>
  <button id="restart-btn">Restart</button>
</div>

<div id="mobile-controls" style="display:none;">
  <div id="left-btn" class="control-btn">◀</div>
  <div id="shoot-btn" class="control-btn">●</div>
  <div id="right-btn" class="control-btn">▶</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>

let scene, camera, renderer;
let bullets=[], enemies=[];
let playerSpeed=0.08; // slightly slower
let score=0, lives=3, level=1, running=false;
let keys={}, isMobile=false;
let lastEnemySpawn=0, ENEMY_INTERVAL=2500, ENEMY_SPEED=0.03;
let gunMesh;

// UI elements
const scoreboard=document.getElementById('scoreboard');
const levelboard=document.getElementById('levelboard');
const livesboard=document.getElementById('livesboard');
const startScreen=document.getElementById('start-screen');
const startBtn=document.getElementById('start-btn');
const gameOverScreen=document.getElementById('game-over-screen');
const finalScore=document.getElementById('final-score');
const restartBtn=document.getElementById('restart-btn');
const gunSelect=document.getElementById('gunSelect');
const mobileControls=document.getElementById('mobile-controls');
const leftBtn=document.getElementById('left-btn');
const rightBtn=document.getElementById('right-btn');
const shootBtn=document.getElementById('shoot-btn');
const instructions=document.getElementById('instructions');

// Detect mobile
function detectMobile(){
  isMobile = /Mobi|Android/i.test(navigator.userAgent);
  if(isMobile){
    mobileControls.style.display='flex';
    instructions.innerHTML="Use buttons to move & shoot";
  } else {
    instructions.innerHTML="Move: A/D | Shoot: Left Click";
  }
}

// Initialize Three.js scene
function init(){
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x444444);
  
  camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.set(0,1.5,5);
  camera.lookAt(0,1.5,0);
  
  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  document.body.appendChild(renderer.domElement);
  
  // Room: floor and walls
  const floorMat=new THREE.MeshStandardMaterial({color:0x555555});
  const floor=new THREE.Mesh(new THREE.PlaneGeometry(20,20), floorMat);
  floor.rotation.x=-Math.PI/2; floor.position.y=0; scene.add(floor);
  
  const wallMat=new THREE.MeshStandardMaterial({color:0x666666});
  const backWall=new THREE.Mesh(new THREE.PlaneGeometry(20,10), wallMat);
  backWall.position.z=-10; backWall.position.y=5; scene.add(backWall);
  const leftWall=new THREE.Mesh(new THREE.PlaneGeometry(20,10), wallMat);
  leftWall.rotation.y=Math.PI/2; leftWall.position.x=-10; leftWall.position.y=5; scene.add(leftWall);
  const rightWall=new THREE.Mesh(new THREE.PlaneGeometry(20,10), wallMat);
  rightWall.rotation.y=-Math.PI/2; rightWall.position.x=10; rightWall.position.y=5; scene.add(rightWall);
  
  // Light
  const light=new THREE.DirectionalLight(0xffffff,1);
  light.position.set(5,10,5); scene.add(light);
  
  // Gun
  gunMesh=createGunMesh(gunSelect.value);
  gunMesh.position.set(0,1.4,0.5); // in front of camera
  camera.add(gunMesh);
  scene.add(camera);
  
  // Event listeners
  window.addEventListener('resize',()=>{ camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth,window.innerHeight); });
  window.addEventListener('keydown', e=>{ if(!isMobile) keys[e.key.toLowerCase()]=true; });
  window.addEventListener('keyup', e=>{ if(!isMobile) keys[e.key.toLowerCase()]=false; });
  window.addEventListener('mousedown', e=>{ if(!running) return; if(!isMobile && e.button===0) shootBullet(); });

  leftBtn.addEventListener('touchstart',()=>keys['a']=true);
  leftBtn.addEventListener('touchend',()=>keys['a']=false);
  rightBtn.addEventListener('touchstart',()=>keys['d']=true);
  rightBtn.addEventListener('touchend',()=>keys['d']=false);
  shootBtn.addEventListener('touchstart',()=>shootBullet());
}

// Create forward-facing gun
function createGunMesh(type){
  const group=new THREE.Group();
  if(type==='ak'){
    const barrel=new THREE.Mesh(new THREE.BoxGeometry(0.05,0.05,0.7), new THREE.MeshStandardMaterial({color:0x333333}));
    barrel.position.set(0,0,0.35);
    const body=new THREE.Mesh(new THREE.BoxGeometry(0.1,0.05,0.2), new THREE.MeshStandardMaterial({color:0x222222}));
    body.position.set(0,-0.025,-0.1);
    group.add(barrel); group.add(body);
  } else { // Deagle
    const barrel=new THREE.Mesh(new THREE.BoxGeometry(0.05,0.05,0.5), new THREE.MeshStandardMaterial({color:0x444444}));
    barrel.position.set(0,0,0.25);
    const handle=new THREE.Mesh(new THREE.BoxGeometry(0.08,0.05,0.15), new THREE.MeshStandardMaterial({color:0x222222}));
    handle.position.set(0,-0.025,-0.05);
    group.add(barrel); group.add(handle);
  }
  // Tip indicator
  const tip=new THREE.Mesh(new THREE.ConeGeometry(0.08,0.2,8), new THREE.MeshStandardMaterial({color:0xffff00}));
  tip.position.set(0,0,0.8);
  tip.rotation.x=Math.PI;
  group.add(tip);
  return group;
}

// Shoot bullet
function shootBullet(){
  if(!running) return;
  const bullet=new THREE.Mesh(new THREE.SphereGeometry(0.05,8,8), new THREE.MeshStandardMaterial({color:0xffff00}));
  const gunWorldPos=new THREE.Vector3();
  gunMesh.getWorldPosition(gunWorldPos);
  bullet.position.copy(gunWorldPos);
  
  // Bullet goes toward where gun is pointing
  const dir=new THREE.Vector3(0,0,1).applyQuaternion(gunMesh.quaternion).normalize();
  bullets.push({mesh:bullet,direction:dir});
  scene.add(bullet);
}

// Spawn enemy
function spawnEnemy(){
  const enemy=new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5), new THREE.MeshStandardMaterial({color:0xff0000}));
  enemy.position.set((Math.random()-0.5)*8,0.25,-15);
  enemies.push(enemy);
  scene.add(enemy);
}

// Update gun to aim at closest enemy
function updateGunAim(){
  if(enemies.length===0) return;
  let closest=null;
  let minDist=Infinity;
  enemies.forEach(e=>{
    const dist=e.position.distanceTo(camera.position);
    if(dist<minDist && e.position.z<camera.position.z){
      minDist=dist;
      closest=e;
    }
  });
  if(closest){
    gunMesh.lookAt(closest.position);
  }
}

// Update game
function update(){
  if(keys['a']) camera.position.x -= playerSpeed;
  if(keys['d']) camera.position.x += playerSpeed;
  camera.position.x=Math.max(-8,Math.min(8,camera.position.x));

  bullets.forEach((b,i)=>{
    b.mesh.position.addScaledVector(b.direction,0.3);
    if(b.mesh.position.z<-20 || b.mesh.position.z>10){ scene.remove(b.mesh); bullets.splice(i,1); }
  });

  enemies.forEach((e,i)=>{
    e.position.z += ENEMY_SPEED;
    bullets.forEach((b,j)=>{
      if(e.position.distanceTo(b.mesh.position)<0.5){
        scene.remove(e); enemies.splice(i,1);
        scene.remove(b.mesh); bullets.splice(j,1);
        score+=10; scoreboard.textContent='Score: '+score;
      }
    });
    if(e.position.z>camera.position.z+0.5){
      scene.remove(e); enemies.splice(i,1);
      lives--; livesboard.textContent='Lives: '+lives;
      if(lives<=0) endGame();
    }
  });

  if(Date.now()-lastEnemySpawn>ENEMY_INTERVAL){ spawnEnemy(); lastEnemySpawn=Date.now(); }

  let newLevel=Math.floor(score/100)+1;
  if(newLevel>level){ level=newLevel; ENEMY_SPEED+=0.005; ENEMY_INTERVAL=Math.max(500,ENEMY_INTERVAL-100); levelboard.textContent='Level: '+level; }

  updateGunAim();
}

// Animate
function animate(){
  if(running) requestAnimationFrame(animate);
  update();
  renderer.render(scene,camera);
}

// Start / End game
function startGame(){
  detectMobile();
  if(!scene) init();
  score=0; lives=3; level=1; bullets=[]; enemies=[];
  scoreboard.textContent='Score: 0';
  livesboard.textContent='Lives: 3';
  levelboard.textContent='Level: 1';
  running=true;
  startScreen.style.display='none';
  gameOverScreen.style.display='none';
  camera.position.set(0,1.5,5);
  animate();
}

function endGame(){
  running=false;
  finalScore.textContent='Your score: '+score;
  gameOverScreen.style.display='flex';
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);
gunSelect.addEventListener('change', ()=>{
  camera.remove(gunMesh);
  gunMesh=createGunMesh(gunSelect.value);
  gunMesh.position.set(0,1.4,0.5);
  camera.add(gunMesh);
});

detectMobile();

</script>
</body>
</html>
