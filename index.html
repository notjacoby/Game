<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Improved Shooting Game</title>
<style>
body { margin:0; overflow:hidden; background:#111; font-family:sans-serif; }
#crosshair {
  position:absolute; left:50%; top:50%; width:20px; height:20px; margin-left:-10px; margin-top:-10px; pointer-events:none;
}
#crosshair::before, #crosshair::after { content:""; position:absolute; background:white; }
#crosshair::before { left:50%; top:0; width:2px; height:100%; margin-left:-1px; }
#crosshair::after { top:50%; left:0; width:100%; height:2px; margin-top:-1px; }

#ui { position:absolute; top:10px; left:10px; color:white; z-index:10; }
#start-screen, #game-over-screen {
  position:absolute; inset:0; background:rgba(0,0,0,0.85); color:white;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; z-index:10;
  text-align:center;
}
button { padding:10px 20px; font-size:16px; border:none; border-radius:6px; cursor:pointer; background:#4caf50; color:white; }

#mobile-controls {
  position:absolute; bottom:20px; width:100%; display:flex; justify-content:space-between; z-index:10;
  display:none;
}
.control-group { display:flex; gap:20px; margin-left:20px; }
.control-btn { width:60px; height:60px; background:rgba(255,255,255,0.3); border-radius:50%; font-size:24px; text-align:center; line-height:60px; user-select:none; }
.control-btn:active { background:rgba(255,255,255,0.6); }
</style>
</head>
<body>

<div id="ui">
  <div id="scoreboard">Score: 0</div>
  <div id="livesboard">Lives: 3</div>
</div>

<div id="crosshair"></div>

<div id="start-screen">
  <h2>Shooting Game</h2>
  <p>Move: A/D or Left/Right Buttons | Shoot: Left Click or Shoot Button</p>
  <button id="start-btn">Start Game</button>
</div>

<div id="game-over-screen" style="display:none;">
  <h2>Game Over!</h2>
  <p id="final-score"></p>
  <button id="restart-btn">Restart</button>
</div>

<div id="mobile-controls">
  <div class="control-group">
    <div id="left-btn" class="control-btn">◀</div>
    <div id="right-btn" class="control-btn">▶</div>
  </div>
  <div class="control-group">
    <div id="shoot-btn" class="control-btn">●</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>

<script>
let scene, camera, renderer;
let player, bullets=[], enemies=[];
let keys={}, score=0, lives=3, running=false;
let lastSpawn=0, ENEMY_INTERVAL=3000, ENEMY_SPEED=0.01, PLAYER_SPEED=0.15;

// UI
const scoreboard=document.getElementById('scoreboard');
const livesboard=document.getElementById('livesboard');
const startScreen=document.getElementById('start-screen');
const startBtn=document.getElementById('start-btn');
const gameOverScreen=document.getElementById('game-over-screen');
const finalScore=document.getElementById('final-score');
const restartBtn=document.getElementById('restart-btn');
const mobileControls=document.getElementById('mobile-controls');
const leftBtn=document.getElementById('left-btn');
const rightBtn=document.getElementById('right-btn');
const shootBtn=document.getElementById('shoot-btn');

// Detect mobile
function detectMobile(){
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  if(isMobile){
    mobileControls.style.display='flex';
    if(window.innerHeight > window.innerWidth){
      alert("Rotate your device to landscape for better gameplay");
    }
  }
}

// Init scene
function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x222222);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0,1.5,5);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const light = new THREE.DirectionalLight(0xffffff,1);
  light.position.set(5,10,5);
  scene.add(light);

  // Floor
  const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshStandardMaterial({color:0x555555}));
  floor.rotation.x=-Math.PI/2;
  scene.add(floor);

  // Player box
  player = new THREE.Mesh(new THREE.BoxGeometry(0.3,0.3,0.5), new THREE.MeshStandardMaterial({color:0x00ff00}));
  player.position.set(0,0.15,0);
  scene.add(player);

  // Keyboard
  window.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
  window.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);
  window.addEventListener('mousedown', e=>{ if(e.button===0) shootBullet(); });

  // Mobile buttons
  leftBtn.addEventListener('touchstart', ()=>keys['a']=true);
  leftBtn.addEventListener('touchend', ()=>keys['a']=false);
  rightBtn.addEventListener('touchstart', ()=>keys['d']=true);
  rightBtn.addEventListener('touchend', ()=>keys['d']=false);
  shootBtn.addEventListener('touchstart', ()=>shootBullet());

  window.addEventListener('resize', ()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}

// Shoot bullet
function shootBullet(){
  if(!running) return;
  const bullet = new THREE.Mesh(new THREE.SphereGeometry(0.05,8,8), new THREE.MeshStandardMaterial({color:0xffff00}));
  bullet.position.set(player.position.x, player.position.y, player.position.z-0.5);
  bullets.push({mesh:bullet,dir:new THREE.Vector3(0,0,-1)});
  scene.add(bullet);
}

// Spawn enemy
function spawnEnemy(){
  const enemy = new THREE.Mesh(new THREE.BoxGeometry(0.5,1,0.3), new THREE.MeshStandardMaterial({color:0xff0000}));
  enemy.position.set((Math.random()-0.5)*8,0,-20);
  enemies.push(enemy);
  scene.add(enemy);
}

// Update loop
function update(){
  // Movement
  if(keys['a']) player.position.x-=PLAYER_SPEED;
  if(keys['d']) player.position.x+=PLAYER_SPEED;

  // Bullets
  bullets.forEach((b,i)=>{
    b.mesh.position.addScaledVector(b.dir,0.5);
    if(b.mesh.position.z<-50){ scene.remove(b.mesh); bullets.splice(i,1); }
  });

  // Enemies
  enemies.forEach((e,i)=>{
    e.position.z+=ENEMY_SPEED;
    bullets.forEach((b,j)=>{
      if(e.position.distanceTo(b.mesh.position)<0.5){
        scene.remove(e); enemies.splice(i,1);
        scene.remove(b.mesh); bullets.splice(j,1);
        score+=10; scoreboard.textContent='Score: '+score;
      }
    });
    if(e.position.z>player.position.z){
      scene.remove(e); enemies.splice(i,1);
      lives--; livesboard.textContent='Lives: '+lives;
      if(lives<=0) endGame();
    }
  });

  if(Date.now()-lastSpawn>ENEMY_INTERVAL){ spawnEnemy(); lastSpawn=Date.now(); }
}

// Animate
function animate(){
  if(!running) return;
  requestAnimationFrame(animate);
  update();
  renderer.render(scene,camera);
}

// Start and end game
function startGame(){
  detectMobile();
  if(!scene) init();
  score=0; lives=3; bullets=[]; enemies=[];
  scoreboard.textContent='Score: 0'; livesboard.textContent='Lives: 3';
  running=true;
  startScreen.style.display='none';
  gameOverScreen.style.display='none';
  animate();
}

function endGame(){
  running=false;
  finalScore.textContent='Your score: '+score;
  gameOverScreen.style.display='flex';
}

// Buttons
startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);

</script>
</body>
</html>
